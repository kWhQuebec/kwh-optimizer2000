# üìä Analyse R√©vis√©e du Module de Financement - kWh Optimizer 2000

*Analyse du 27 janvier 2026*

---

## üéØ Compr√©hension du Module

Le module `FinancingCalculator` dans `site-detail.tsx` pr√©sente **4 options d'acquisition** √† un prospect:

| Mode | But | Qui offre? |
|------|-----|------------|
| **Cash (Comptant)** | Achat direct avec paiement initial | kWh |
| **Loan (Pr√™t)** | Financement par pr√™t bancaire | kWh (via partenaire) |
| **Lease (Cr√©dit-bail)** | Location avec option d'achat | kWh (via partenaire) |
| **PPA (Tiers)** | ‚ö†Ô∏è **Mod√®le concurrent** pour comparaison | Concurrent (ex: TRC Solar) |

### ‚úÖ Le mode PPA est un outil de comparaison

Le label UI confirme: **"Mod√®le concurrent (ex: TRC Solar)"**

Ce n'est PAS une offre de kWh, mais un outil pour montrer au prospect ce qu'un concurrent comme TRC Solar proposerait, permettant une comparaison directe avec les options kWh.

---

## üìã Analyse D√©taill√©e par Mode

### 1. üíµ MODE CASH ‚Äî ‚úÖ Calculs Corrects

**Logique:**
```
upfrontCashNeeded = CAPEX brut - HQ Solar - (HQ Batterie √ó 50%)
year1Returns = (HQ Batterie √ó 50%) + Tax Shield (CCA)
year2Returns = CII f√©d√©ral (30%)
netSavings (25 ans) = √âconomies annuelles √ó 25 - CAPEX net
```

**Points forts:**
- ‚úÖ Timing r√©aliste des incitatifs (Jour 0 / An 1 / An 2)
- ‚úÖ Rabais HQ d√©duit imm√©diatement du paiement initial
- ‚úÖ CCA pr√©sent√© comme "Tax Shield" simplifi√©
- ‚úÖ Inclut les incitatifs batterie HQ

**‚ö†Ô∏è Point d'attention:**
- Le "Tax Shield" est une valeur fixe calcul√©e par `breakdown.taxShield`
- Dans `cashflowEngine.ts`, le CCA utilise la m√©thode declining balance
- Pour un prospect, la simplification est acceptable, mais les chiffres pourraient diff√©rer l√©g√®rement

---

### 2. üí≥ MODE LOAN ‚Äî ‚úÖ Calculs Corrects

**Logique:**
```
loanAmount = CAPEX brut - mise de fonds
monthlyPayment = Formule d'amortissement standard
totalLoanPayments = (paiement mensuel √ó nb mois) + mise de fonds
effectiveLoanCost = totalLoanPayments - totalIncentives
netSavings (25 ans) = √âconomies annuelles √ó 25 - effectiveLoanCost
```

**Points forts:**
- ‚úÖ Param√®tres ajustables (dur√©e, taux, mise de fonds)
- ‚úÖ Formule d'amortissement standard correcte
- ‚úÖ Incitatifs retourn√©s au client comme cash
- ‚úÖ Flux de tr√©sorerie r√©aliste affich√©

**‚úÖ Formule v√©rifi√©e:**
```javascript
monthlyPayment = (P √ó r √ó (1+r)^n) / ((1+r)^n - 1)
// o√π P = principal, r = taux mensuel, n = nombre de paiements
```

---

### 3. üìÑ MODE LEASE (Cr√©dit-bail) ‚Äî ‚úÖ Calculs Corrects

**Logique:**
```
leaseFinancedAmount = CAPEX brut (100% financ√©)
leaseMonthlyPayment = Formule d'amortissement standard
leaseTotalPayments = paiement mensuel √ó nb mois
leaseTotalIncentives = HQ Solar + HQ Batterie + CII + Tax Shield
effectiveLeaseCost = leaseTotalPayments - leaseTotalIncentives
```

**Points forts:**
- ‚úÖ Cr√©dit-bail = client trait√© comme propri√©taire fiscalement
- ‚úÖ Client re√ßoit TOUS les incitatifs (contrairement au PPA)
- ‚úÖ Formule d'amortissement identique au pr√™t
- ‚úÖ Param√®tres ajustables (dur√©e, taux implicite)

**Note importante:**
Le code commente clairement que dans un cr√©dit-bail, le client est le "propri√©taire fiscal" et re√ßoit donc:
- Les rabais HQ (solaire + batterie)
- Le CII f√©d√©ral
- Le cr√©dit CCA

---

### 4. ‚ö° MODE PPA ‚Äî Outil de Comparaison Concurrentielle

**But:** Montrer au prospect ce qu'un concurrent PPA comme TRC Solar proposerait.

**Logique par d√©faut (mod√®le TRC Solar):**
```
Year 1: 100% du tarif HQ √ó production
Year 2+: 60% du tarif HQ √ó production
Total PPA = Year 1 + (Year 2-n √ó (n-1 ans))
Post-PPA (25-n ans): √âlectricit√© gratuite (transfert pour 1$)
```

**Ce qui est affich√© au prospect:**
- ‚ö†Ô∏è **Avertissement l√©gal** en rouge prominent
- üìä Param√®tres ajustables pour simuler diff√©rentes offres concurrentes
- üí∏ "Incitatifs conserv√©s par le fournisseur PPA" (en rouge)
- üè† "Transfert propri√©t√© apr√®s terme" (en vert)

**Points forts:**
- ‚úÖ Clairement identifi√© comme "Mod√®le concurrent"
- ‚úÖ Permet de comparer apple-to-apple avec les options kWh
- ‚úÖ Met en √©vidence que le client perd les incitatifs
- ‚úÖ Param√®tres flexibles pour diff√©rents concurrents

---

## üîç Comparaison avec `cashflowEngine.ts`

| Aspect | site-detail.tsx | cashflowEngine.ts |
|--------|-----------------|-------------------|
| **Modes** | 4 (Cash, Loan, Lease, PPA) | 3 (Cash, Lease, PPA) |
| **Loan mode** | ‚úÖ Impl√©ment√© | ‚ùå Absent |
| **But** | Pr√©sentation prospect | Calculs Market Intelligence |
| **Lease calcul** | Amortization standard | Division + 15% premium |
| **PPA mod√®le** | Concurrent (TRC par d√©faut) | G√©n√©rique avec inflation |
| **O&M costs** | ‚ùå Non inclus (simplifi√©) | ‚úÖ Inclus |
| **Inflation kWh** | ‚ùå Non appliqu√©e | ‚úÖ 4.8%/an |

### Pourquoi deux syst√®mes diff√©rents?

1. **site-detail.tsx** = Outil de **vente/pr√©sentation** simplifi√© pour prospects
2. **cashflowEngine.ts** = Mod√®le **analytique d√©taill√©** pour Market Intelligence

Les deux ont des buts diff√©rents et c'est acceptable.

---

## ‚úÖ Ce qui Fonctionne Bien

1. **Cash, Loan, Lease** ‚Äî Calculs corrects et coh√©rents
2. **Timing des incitatifs** ‚Äî R√©aliste et bien document√©
3. **PPA comme comparateur** ‚Äî Clairement identifi√© comme concurrent
4. **Interface utilisateur** ‚Äî Sliders interactifs pour explorer les sc√©narios
5. **Graphique comparatif** ‚Äî Flux cumulatifs sur 25 ans

---

## ‚ö†Ô∏è Points d'Am√©lioration Potentiels

### 1. Coh√©rence du Lease entre les deux syst√®mes

**Probl√®me:**
- `site-detail.tsx` utilise une formule d'amortissement standard
- `cashflowEngine.ts` utilise `cost / term √ó (1 + 0.15)`

**Impact:** Si un prospect voit les chiffres de site-detail puis passe √† Market Intelligence, les paiements mensuels Lease pourraient diff√©rer.

**Recommandation:** Aligner les deux calculs (pr√©f√©rer l'amortissement standard).

### 2. Absence des co√ªts O&M dans site-detail

**Situation actuelle:**
- `site-detail.tsx` ne d√©duit pas les co√ªts O&M des √©conomies
- `cashflowEngine.ts` inclut 1% CAPEX + 2.5% escalation

**Impact:** Les √©conomies nettes affich√©es au prospect sont l√©g√®rement optimistes.

**Recommandation:**
- Option A: Ajouter une note "hors O&M"
- Option B: Int√©grer un O&M simplifi√© (ex: forfait annuel)

### 3. Pas d'inflation des tarifs HQ dans site-detail

**Situation actuelle:**
- `annualSavings` reste constant sur 25 ans
- `cashflowEngine.ts` applique 4.8%/an d'inflation

**Impact:** Sous-estime les √©conomies √† long terme (ce qui est conservateur, donc acceptable).

### 4. Synchroniser Loan dans cashflowEngine

**Probl√®me:** Le mode Loan n'existe pas dans `cashflowEngine.ts`

**Impact:** Market Intelligence ne peut pas afficher les analyses Loan.

**Recommandation:** Ajouter le mode Loan √† `cashflowEngine.ts` si Market Intelligence doit le supporter.

---

## üí° Conclusion pour les Prospects

Le module de financement tel qu'impl√©ment√© dans `site-detail.tsx` est **fiable et pertinent** pour pr√©senter les options √† un prospect:

| Mode | Fiabilit√© | Pertinence | Note |
|------|-----------|------------|------|
| Cash | ‚úÖ Excellente | ‚úÖ Excellente | Timing r√©aliste des incitatifs |
| Loan | ‚úÖ Excellente | ‚úÖ Excellente | Formule standard, param√®tres flexibles |
| Lease | ‚úÖ Bonne | ‚úÖ Excellente | Formule correcte, l√©g√®rement diff√©rente de cashflowEngine |
| PPA | ‚úÖ Bonne* | ‚úÖ Excellente | *Clairement un outil de comparaison concurrentielle |

### Points √† communiquer aux prospects:

1. **Cash/Loan/Lease** = Options kWh avec r√©cup√©ration des incitatifs
2. **PPA** = Ce que les concurrents proposent (pour comparaison)
3. Les √©conomies sont bas√©es sur le tarif HQ actuel (conservateur)
4. Co√ªts O&M non inclus (responsabilit√© client ou option de service kWh)

---

*Analyse effectu√©e le 27 janvier 2026*
